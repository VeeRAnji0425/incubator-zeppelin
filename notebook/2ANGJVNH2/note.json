{
  "paragraphs": [
    {
      "text": "%md\n\nSpark-Cassandra-Solr combo\n\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\n\n\u003eWarning: to use this demo, you\u0027ll need to have **Datastax Enterprise 4.7.0**",
      "config": {
        "colWidth": 12.0,
        "graph": {
          "mode": "table",
          "height": 300.0,
          "optionOpen": false,
          "keys": [],
          "values": [],
          "groups": [],
          "scatter": {}
        },
        "editorHide": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "jobName": "paragraph_1432136878086_787836253",
      "id": "20150520-174758_534900824",
      "result": {
        "code": "SUCCESS",
        "type": "HTML",
        "msg": "\u003ch1\u003eSpark-Cassandra-Solr combo\u003c/h1\u003e\n\u003cblockquote\u003e\u003cp\u003eWarning: to use this demo, you\u0027ll need to have \u003cstrong\u003eDatastax Enterprise 4.7.0\u003c/strong\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n"
      },
      "dateCreated": "May 20, 2015 5:47:58 PM",
      "dateStarted": "Jun 17, 2015 11:10:39 AM",
      "dateFinished": "Jun 17, 2015 11:10:40 AM",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "title": "Prepare data",
      "text": "import org.apache.spark.{SparkConf, SparkContext}\nimport com.datastax.spark.connector._\nimport org.apache.spark.rdd.RDD\nimport org.apache.spark.sql.SchemaRDD\nimport org.apache.spark.sql.cassandra.CassandraSQLContext\nimport com.datastax.spark.connector.cql.CassandraConnector\n//import scala.collection.JavaConversions._\nimport scala.collection.JavaConverters._\nval cc \u003d new CassandraSQLContext(sc)\n\nvar musicStyles:List[String] \u003d Nil \nvar countries:List[String] \u003d Nil \n\nCassandraConnector(sc.getConf).withSessionDo { \n    session \u003d\u003e {\n        musicStyles \u003d session.execute(\"SELECT style FROM spark_demo.performers_distribution_by_style\").\n            all().\n            toList.\n            map(row \u003d\u003e row.getString(\"style\")).\n            toSet.\n            toList.\n            sorted\n            \n        countries \u003d session.execute(\"SELECT DISTINCT name FROM spark_demo.countries\").\n            all().\n            toList.\n            map(row \u003d\u003e row.getString(\"name\")).\n            toSet.\n            toList.\n            sorted   \n    }\n}\n\nval context \u003d z.getInterpreterContext()\ndef search(before:Object, after:Object):Unit \u003d {\n    z.run(3,context)\n}\nz.angularUnbind(\"countries\")\nz.angularUnbind(\"styles\")\nz.angularUnbind(\"album_year\")\nz.angularUnbind(\"artist_country\")\nz.angularUnbind(\"artist_style\")\nz.angularUnbind(\"updateDisplay\")\n\nz.angularUnwatch(\"updateDisplay\")\n\nz.angularBind(\"countries\", countries.asJava)\nz.angularBind(\"styles\", musicStyles.asJava)\nz.angularBind(\"album_year\",\"[2010 TO *]\")\nz.angularBind(\"artist_country\",\"USA\")\nz.angularBind(\"artist_style\",\"Rock\")\nz.angularBind(\"updateDisplay\",true)\nz.angularWatch(\"updateDisplay\",search _)",
      "config": {
        "colWidth": 12.0,
        "graph": {
          "mode": "table",
          "height": 300.0,
          "optionOpen": false,
          "keys": [],
          "values": [],
          "groups": [],
          "scatter": {}
        },
        "tableHide": true,
        "title": true,
        "editorHide": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "jobName": "paragraph_1432483305349_2122532186",
      "id": "20150524-180145_111739812",
      "result": {
        "code": "SUCCESS",
        "type": "TEXT",
        "msg": "import org.apache.spark.{SparkConf, SparkContext}\nimport com.datastax.spark.connector._\nimport org.apache.spark.rdd.RDD\nimport org.apache.spark.sql.SchemaRDD\nimport org.apache.spark.sql.cassandra.CassandraSQLContext\nimport com.datastax.spark.connector.cql.CassandraConnector\nimport scala.collection.JavaConverters._\ncc: org.apache.spark.sql.cassandra.CassandraSQLContext \u003d org.apache.spark.sql.cassandra.CassandraSQLContext@37e376f9\nmusicStyles: List[String] \u003d List()\ncountries: List[String] \u003d List()\ncontext: org.apache.zeppelin.interpreter.InterpreterContext \u003d org.apache.zeppelin.interpreter.InterpreterContext@690b1d49\nsearch: (before: Object, after: Object)Unit\n"
      },
      "dateCreated": "May 24, 2015 6:01:45 PM",
      "dateStarted": "Jun 17, 2015 11:15:08 AM",
      "dateFinished": "Jun 17, 2015 11:15:13 AM",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "title": "Search Form",
      "text": "%angular\n\u003cdiv class\u003d\"row\"\u003e\n    \u003cdiv class\u003d\"panel panel-primary col-md-12\"\u003e\n        \u003cdiv class\u003d\"panel-heading\"\u003e\n            \u003ch3 class\u003d\"panel-title\"\u003eSearch Analytics\u003c/h3\u003e\n        \u003c/div\u003e\n        \u003cdiv class\u003d\"panel-body text-center\"\u003e\n            \u003ch4\u003eList all albums release \u003cbr/\u003e\n            after \u003cstrong\u003eAlbum Year\u003c/strong\u003e \u003cbr/\u003e\n            of \u003cstrong\u003eArtist Country\u003c/strong\u003e artists\u003cbr/\u003e\n            having style \u003cstrong\u003eArtist Style\u003c/strong\u003e\n            \u003c/h4\u003e\n        \u003c/div\u003e\n    \u003c/div\u003e\n\u003c/div\u003e    \n\u003cbr/\u003e\n\u003cdiv class\u003d\"row\"\u003e\n    \u003cdiv class\u003d\"panel panel-default col-md-12\"\u003e\n        \u003cdiv class\u003d\"panel-heading\"\u003e\n            \u003ch4 class\u003d\"panel-title\"\u003eSearch Form\u003c/h4\u003e\n        \u003c/div\u003e\n        \u003cdiv class\u003d\"panel-body\"\u003e\n            \u003cform class\u003d\"form-horizontal\"\u003e\n                \u003cdiv class\u003d\"form-group\"\u003e\n                    \u003clabel for\u003d\"year_id\" class\u003d\"col-md-4 control-label\"\u003eAlbum Year\u003c/label\u003e\n                    \u003cdiv class\u003d\"col-md-8\"\u003e\n                        \u003cinput type\u003d\"text\" class\u003d\"form-control\" id\u003d\"year_id\" \n                            ng-model\u003d\"album_year\"\n                            placeholder\u003d\"Album release year. Format \u003d yyyy or [yyyy TO yyyy], wildcard * possible\"\u003e\n                    \u003c/div\u003e    \n                \u003c/div\u003e\n                \u003cdiv class\u003d\"form-group\"\u003e\n                    \u003clabel for\u003d\"country_id\" class\u003d\"col-md-4 control-label\"\u003eArtist Country\u003c/label\u003e\n                    \u003cdiv class\u003d\"col-md-8\"\u003e                \n                        \u003cselect class\u003d\"form-control\" id\u003d\"country_id\" ng-options\u003d\"country for country in countries\" ng-model\u003d\"artist_country\"/\u003e\n                    \u003c/div\u003e    \n                \u003c/div\u003e\n                \u003cdiv class\u003d\"form-group\"\u003e\n                    \u003clabel for\u003d\"style_id\" class\u003d\"col-md-4 control-label\"\u003eArtist Style\u003c/label\u003e\n                    \u003cdiv class\u003d\"col-md-8\"\u003e                \n                        \u003cselect  class\u003d\"form-control\" id\u003d\"style_id\" ng-options\u003d\"style for style in styles\" ng-model\u003d\"artist_style\"/\u003e\n                    \u003c/div\u003e    \n                \u003c/div\u003e                \n                \u003cdiv class\u003d\"form-group\"\u003e\n                    \u003cdiv class\u003d\"col-md-offset-4 col-md-8\"\u003e\n                        \u003cbutton type\u003d\"submit\" class\u003d\"btn btn-primary\" ng-click\u003d\"updateDisplay\u003d!updateDisplay\"\u003eSearch\u003c/button\u003e\n                    \u003c/div\u003e\n                \u003c/div\u003e\n            \u003c/form\u003e\n        \u003c/div\u003e\n    \u003c/div\u003e\n",
      "config": {
        "colWidth": 4.0,
        "graph": {
          "mode": "table",
          "height": 300.0,
          "optionOpen": false,
          "keys": [],
          "values": [],
          "groups": [],
          "scatter": {}
        },
        "editorHide": true,
        "tableHide": false,
        "title": false
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "jobName": "paragraph_1434015360489_-428903733",
      "id": "20150611-113600_761626137",
      "result": {
        "code": "SUCCESS",
        "type": "ANGULAR",
        "msg": "\u003cdiv class\u003d\"row\"\u003e\n    \u003cdiv class\u003d\"panel panel-primary col-md-12\"\u003e\n        \u003cdiv class\u003d\"panel-heading\"\u003e\n            \u003ch3 class\u003d\"panel-title\"\u003eSearch Analytics\u003c/h3\u003e\n        \u003c/div\u003e\n        \u003cdiv class\u003d\"panel-body text-center\"\u003e\n            \u003ch4\u003eList all albums release \u003cbr/\u003e\n            after \u003cstrong\u003eAlbum Year\u003c/strong\u003e \u003cbr/\u003e\n            of \u003cstrong\u003eArtist Country\u003c/strong\u003e artists\u003cbr/\u003e\n            having style \u003cstrong\u003eArtist Style\u003c/strong\u003e\n            \u003c/h4\u003e\n        \u003c/div\u003e\n    \u003c/div\u003e\n\u003c/div\u003e    \n\u003cbr/\u003e\n\u003cdiv class\u003d\"row\"\u003e\n    \u003cdiv class\u003d\"panel panel-default col-md-12\"\u003e\n        \u003cdiv class\u003d\"panel-heading\"\u003e\n            \u003ch4 class\u003d\"panel-title\"\u003eSearch Form\u003c/h4\u003e\n        \u003c/div\u003e\n        \u003cdiv class\u003d\"panel-body\"\u003e\n            \u003cform class\u003d\"form-horizontal\"\u003e\n                \u003cdiv class\u003d\"form-group\"\u003e\n                    \u003clabel for\u003d\"year_id\" class\u003d\"col-md-4 control-label\"\u003eAlbum Year\u003c/label\u003e\n                    \u003cdiv class\u003d\"col-md-8\"\u003e\n                        \u003cinput type\u003d\"text\" class\u003d\"form-control\" id\u003d\"year_id\" \n                            ng-model\u003d\"album_year\"\n                            placeholder\u003d\"Album release year. Format \u003d yyyy or [yyyy TO yyyy], wildcard * possible\"\u003e\n                    \u003c/div\u003e    \n                \u003c/div\u003e\n                \u003cdiv class\u003d\"form-group\"\u003e\n                    \u003clabel for\u003d\"country_id\" class\u003d\"col-md-4 control-label\"\u003eArtist Country\u003c/label\u003e\n                    \u003cdiv class\u003d\"col-md-8\"\u003e                \n                        \u003cselect class\u003d\"form-control\" id\u003d\"country_id\" ng-options\u003d\"country for country in countries\" ng-model\u003d\"artist_country\"/\u003e\n                    \u003c/div\u003e    \n                \u003c/div\u003e\n                \u003cdiv class\u003d\"form-group\"\u003e\n                    \u003clabel for\u003d\"style_id\" class\u003d\"col-md-4 control-label\"\u003eArtist Style\u003c/label\u003e\n                    \u003cdiv class\u003d\"col-md-8\"\u003e                \n                        \u003cselect  class\u003d\"form-control\" id\u003d\"style_id\" ng-options\u003d\"style for style in styles\" ng-model\u003d\"artist_style\"/\u003e\n                    \u003c/div\u003e    \n                \u003c/div\u003e                \n                \u003cdiv class\u003d\"form-group\"\u003e\n                    \u003cdiv class\u003d\"col-md-offset-4 col-md-8\"\u003e\n                        \u003cbutton type\u003d\"submit\" class\u003d\"btn btn-primary\" ng-click\u003d\"updateDisplay\u003d!updateDisplay\"\u003eSearch\u003c/button\u003e\n                    \u003c/div\u003e\n                \u003c/div\u003e\n            \u003c/form\u003e\n        \u003c/div\u003e\n    \u003c/div\u003e\n"
      },
      "dateCreated": "Jun 11, 2015 11:36:00 AM",
      "dateStarted": "Jun 17, 2015 1:38:19 PM",
      "dateFinished": "Jun 17, 2015 1:38:20 PM",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "title": "restrict with solr then aggregate with spark",
      "text": "//List all albums release of American artists having style Rock after 2010\ncc.cassandraSql(s\"\"\"\n    SELECT a.year,a.performer,a.title,p.country\n    FROM spark_demo.albums a\n    JOIN spark_demo.performers p\n    ON a.performer \u003d p.name\n    WHERE a.solr_query\u003d\u0027year:${z.angular(\"album_year\")}\u0027 \n    AND p.solr_query\u003d\u0027country:\"${z.angular(\"artist_country\")}\" AND styles:*${z.angular(\"artist_style\")}*\u0027\n\"\"\".stripMargin).\nmap(row \u003d\u003e (row.getInt(0),row.getString(1),row.getString(2),row.getString(3))).\nsortBy(tuple \u003d\u003e (tuple._1,tuple._2,tuple._3)).\ndisplayAsTable(\"Year\",\"Performer\",\"Title\",\"Country\")",
      "config": {
        "colWidth": 8.0,
        "graph": {
          "mode": "table",
          "height": 434.0,
          "optionOpen": false,
          "keys": [
            {
              "name": "Year",
              "index": 0.0,
              "aggr": "sum"
            }
          ],
          "values": [
            {
              "name": "Performer",
              "index": 1.0,
              "aggr": "sum"
            }
          ],
          "groups": [],
          "scatter": {
            "xAxis": {
              "name": "Year",
              "index": 0.0,
              "aggr": "sum"
            }
          }
        },
        "title": true,
        "tableHide": false,
        "editorHide": true
      },
      "settings": {
        "params": {
          "Album Release Country": "USA",
          "Album Release Year": "[2010 TO *]",
          "Album Year": "[2014 TO *]",
          "Artist Country": "USA",
          "Artist Style": "Pop"
        },
        "forms": {}
      },
      "jobName": "paragraph_1432137037555_-826772635",
      "id": "20150520-175037_1545340445",
      "result": {
        "code": "SUCCESS",
        "type": "TABLE",
        "msg": "Year\n"
      },
      "dateCreated": "May 20, 2015 5:50:37 PM",
      "dateStarted": "Jun 17, 2015 2:16:14 PM",
      "dateFinished": "Jun 17, 2015 2:16:18 PM",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "config": {},
      "settings": {
        "params": {},
        "forms": {}
      },
      "jobName": "paragraph_1434533253747_-934345237",
      "id": "20150617-112733_2141142055",
      "dateCreated": "Jun 17, 2015 11:27:33 AM",
      "status": "READY",
      "progressUpdateIntervalMs": 500
    }
  ],
  "name": "08-SearchAnalytics Mode",
  "id": "2ANGJVNH2",
  "angularObjects": {},
  "config": {
    "looknfeel": "default"
  },
  "info": {}
}